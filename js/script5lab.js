let currentStage = 0; // хранит номер текущего этапа игры
let previousChoice = 0; // сохраняет, какой выбор сделал игрок на предыдущем шаге

// Функция для начала игры
function startGame() {
    document.getElementById('game-output').innerHTML = `Какая-то старуха на улице сказала, что я скоро умру. Что за бред она несла? Устав от долгой прогулки, я решил остановиться в ближайшей кофейни, чтобы отдохнуть. Окружение показалось мне достаточно комфортным. Без изобилия множества ярких декораций, достаточно минималистичное. Но общий оттенок помещения цвета дерева показался мне подходящим для моего усталого состояния. Чего мне не хватало сейчас, так это кружки хорошего кофе, чтобы согреться. Или же... горячего шоколада?
    <br><button onclick="choosePath(1)">Кофе</button><button onclick="choosePath(2)">Горячий шоколад</button>`;
    document.getElementById('game-image').src ="../img/img1_cafe_w.png";
    currentStage = 1; // Устанавливает начальный этап игры
    previousChoice = 0; // Сброс предыдущего выбора
    document.getElementById('start-button').style.display = 'none'; // Скрыть кнопку "Начать игру"
}

// Функция для перехода к следующему этапу
function nextStage() {
    switch (currentStage) {
        case 1:
            if (previousChoice === 1) {
                document.getElementById('game-output').innerHTML = `Я заказал капучино, сел у окна и обхватил горячую кружку ладонями. Тепло разливалось по телу, словно согревая не только руки, но и душу. Сделав первый глоток, я ощутил, как нежная пенка и насыщенный вкус кофе окутывают меня уютом. Казалось, мир за окном стал менее суровым, а усталость потихоньку отступала. <br>Но затем всё изменилось. Глоток, который я сделал чуть торопливее обычного, вдруг не прошёл как надо. Горло пронзило острое чувство, и я закашлялся. Секунда, другая – я пытался вдохнуть, но что-то блокировало воздух. Вокруг забегали люди, послышались голоса, но я уже не мог ничего сказать. В груди кольнуло, ноги подогнулись, и всё погрузилось в темноту.<br>
                <br>Плохая концовка №1. Необычно вредное кофе<br><button onclick="startGame()">Начать заново</button>`;
                document.getElementById('game-image').src ="../img/img2.png";
            } else {
                document.getElementById('game-output').innerHTML = `Я заказал горячий шоколад, села у окна и обхватил кружку, наслаждаясь её тяжестью в руках. Тёплая, насыщенная поверхность согревала мои ладони, а густой запах шоколада словно окутывал, обещая уют и отдых. Сделав первый глоток, я почувствовал, как сладкая, чуть горьковатая жидкость растекается по моему горлу, наполняя тело теплотой и уютом. С каждой секундой ощущение покоя становилось всё более полным. А я погружался в спокойствие, ощущая, как уходят напряжение и усталость.<br>В этот момент мир за окном утратил свою значимость, и всё, что было важно, — это комфорт этого мгновения. Я выпил ещё один глоток и, откинувшись на спинку стула, подумал, что, возможно, теперь самое время вернуться домой.<br>
                <button onclick="choosePath(3)">Пойти домой пешком</button><button onclick="choosePath(4)">Вызвать такси</button>`;
                document.getElementById('game-image').src = '../img/img3.png';
            }
            break;
        case 2:
            if (previousChoice === 3) {
                document.getElementById('game-output').innerHTML = `Я решил не торопиться и пошел домой пешком. Холодный воздух на улице приятно освежал, наполняя лёгкие свежестью. Шаг за шагом я шёл, ощущая, как тело постепенно освобождается от усталости. Улица была пустынна, и звуки города сливались в одно, но мне было всё равно — я наслаждался моментом покоя и свободы. Поглощённый своими мыслями, я переходил дорогу, когда вдруг услышал рев мотора. Мгновение — и передо мной мчался грузовик, не успевший затормозить. Он сбил меня, и мир вокруг резко потемнел.
                <br>Плохая концовка №2. Иссекай<br><button onclick="startGame()">Начать заново</button>`;
                document.getElementById('game-image').src = '../img/img4.png';
            } else {
                document.getElementById('game-output').innerHTML = `Я решил не рисковать и вызвал такси. Устраиваясь в салоне, я почувствовал, как напряжение начинает отступать. В воздухе пахло свежестью, а вибрация автомобиля успокаивала, словно убаюкивая меня после долгой прогулки. Машина скользила по улицам города, и я наслаждался тишиной, которая царила внутри.<br>Вдруг телефон в кармане зазвонил. Это был неожиданный звонок.
                <br><button onclick="choosePath(5)">Ответить на звонок</button><button onclick="choosePath(6)">Отклонить звонок</button>`;
                document.getElementById('game-image').src = '../img/img5.png';
            }
            break;
        case 3:
            if (previousChoice === 6) {
                document.getElementById('game-output').innerHTML = `Я просто отключил звонок и снова откинулся на спинку сиденья, поглощённый думами. Город за окном сменял свои пейзажи, а мои мысли плавно уносились в сторону будущего. Небо было темным, но звезды на нём ещё ярко сверкали. Я невольно улыбнулся — может, это всё просто очередной странный день, который скоро закончится?
                <br><button onclick="choosePath(7)">Закрыть глаза и расслабиться</button><button onclick="choosePath(8)">Посмотреть в окно</button>`;
                document.getElementById('game-image').src = '../img/img5.png';
            } else { 
                document.getElementById('game-output').innerHTML = `Я поднял трубку, и на другом конце раздался хриплый, искажённый голос, который будто бы исходил не от человека. "Хорошо, что ты ответил" — прошептал собеседник, его слова как нож вонзились в меня. И на этом связь оборвалась, оставив меня в полной тишине и страхе, когда я понял, что в комнате стало холодно, а вокруг будто что-то тёмное наблюдает за мной.
                <br><button onclick="choosePath(9)">Оглянуться по салону такси</button><button onclick="choosePath(9)">Посмотреть в окно</button>`;
                document.getElementById('game-image').src = '../img/img5.png';
            }
            break;
        case 4:
            if (previousChoice === 9) {
                document.getElementById('game-output').innerHTML = `Я медленно вдохнул, стараясь взять себя в руки. Ничего странного не происходило — тишина в салоне, обычный свет фар, улицы за окном. Всё это наверняка было игрой моего воображения. "Всё нормально," — тихо сказал я себе, наблюдая за тем, как такси мягко катит по дороге.<br>Водитель, не обративший на меня никакого внимания, остановил машину у моего дома. Я расплатился, поблагодарил его и вышел. Ночной воздух был прохладным, но не резким, и я почувствовал лёгкое облегчение от того, что всё позади.<br>Однако, стоя у подъезда, я ощутил непреодолимое желание выпить чего-нибудь крепкого. Этот день точно заслуживал, чтобы его хоть как-то "запечатать".
                <br><button onclick="choosePath(10)">Зайти в магазин за алкоголем</button><button onclick="choosePath(11)">Пойти домой</button>`;
                document.getElementById('game-image').src = '../img/img8.png';
            } else if (previousChoice === 7) {
                document.getElementById('game-output').innerHTML = `Я закрыл глаза и растворился в тишине, но постепенно почувствовал, как тяжесть на груди становится невыносимой. Я не мог пошевелиться, не мог вдохнуть. В какой-то момент осознал, что не ощущаю собственного тела, и паника охватила меня. Я пытался крикнуть, но не мог. Моё сознание стало угасать, и вскоре всё исчезло.
                <br>Плохая концовка №3. Тишина<br><button onclick="startGame()">Начать заново</button>`;
                document.getElementById('game-image').src = '../img/img6.jpg';
            } else if (previousChoice === 8) {
                document.getElementById('game-output').innerHTML = `Я посмотрел в окно, но вместо ночных огней города улицы были полны мрак и тени, которые не поддавались логике. Всё за окном начало искажаться, а лица людей, мелькавших в темноте, становились нечёткими и страшными. Это не могло быть реальностью, но страх стал нарастать. Вдруг я заметил в отражении стекла нечто темное — фигуру, стоящую прямо за такси. На мгновение мне показалось, что она приближалась, но когда я снова посмотрел в окно, её уже не было.
                <br>Плохая концовка №4. Размывание<br><button onclick="startGame()">Начать заново</button>`;
                document.getElementById('game-image').src = '../img/img7.jpg';
            }
            break;
        case 5:
            if (previousChoice === 10) {
                document.getElementById('game-output').innerHTML = `Я вошёл в магазин, где меня встретил тусклый свет и запах старой плитки. Полки с бутылками были как островки спокойствия в этом странном дне. Я выбрал бутылку виски и направился к кассе.<br>Кассир — пожилой мужчина с невыразительным лицом — посмотрел на меня с какой-то неподдельной усталостью. "Не поздновато ли для таких покупок?" — пробормотал он, пробивая чек. Я лишь пожал плечами, забрал бутылку и вышел на улицу.<br>Воздух казался тише, чем прежде, будто сам мир затаил дыхание. Я направился к своему дому, но не успел я сделать и пары шагов, как нога вдруг соскользнула на чём-то влажном. Я попытался удержать равновесие, размахивая руками, но это только усугубило ситуацию. Земля под ногами будто качнулась, и в следующее мгновение я почувствовал, как лечу назад.<br>Мир вокруг замедлился. Бутылка виски выскользнула из руки и полетела вниз, разбиваясь с глухим звоном об асфальт. Я же продолжал падать, ноги скользили по мокрой плитке, и никакие усилия не помогали остановить этот неминуемый процесс.<br>В последний момент, прежде чем удариться о землю, я почувствовал что-то острое и холодное — возможно, обломок стекла, или, может, просто камень под ногой. Всё тело сотрясло от удара, и моё дыхание остановилось.
                <br>Плохая концовка №5. Виски<br><button onclick="startGame()">Начать заново</button>`;
                document.getElementById('game-image').src = '../img/img9.png';
            } else {
                document.getElementById('game-output').innerHTML = `Я отбросил мысль о магазине. Всё, что мне нужно, — это вернуться домой, закрыть дверь и наконец расслабиться. Подъезд встретил меня тихим уютом: лампочка у входа горела ровным светом, а лестница, хотя и немного скрипнула, была словно приветствием после долгого дня.<br>Оказавшись в своей квартире, я почувствовал, как усталость начала отступать. Скинув куртку, я прошёл на кухню, налил себе стакан воды и включил любимую мелодию на телефоне. Её спокойные звуки словно смывали весь стресс дня.<br>Устроившись в кресле с тёплым пледом, я понял, что всё странное и пугающее осталось где-то далеко. Сегодняшний день, каким бы он ни был, закончился. А впереди меня ждали спокойствие и уют, которые я сам себе создал.
                <br>Единственная хорошая концовка. Поздравляю!<br><button onclick="startGame()">Начать заново</button>`;
                document.getElementById('game-image').src = '../img/img10.png';
            }
            break;
    }
    currentStage++;
}

// Функция для выбора пути
function choosePath(path) {
    previousChoice = path; // Сохраняет сделанный выбор
    switch (path) { // Определяет, какой путь был выбран
        case 1:
        case 2:
        case 3:
        case 4:
        case 5:
        case 6:
        case 7:
        case 8:
        case 9:
        case 10:
        case 11:
        case 12:
        case 13:
        case 14:
        case 15:
        case 16:
        case 17:
        case 18:
        case 19:
        case 20:
        case 21:
            nextStage(); // переход к следующему этапу
            break;
    }
}

// Добавляем обработчик события для кнопки
document.getElementById('start-button').addEventListener('click', startGame);